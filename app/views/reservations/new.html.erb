<% content_for :title, "Confirm Your Reservation" %>
<div class="container my-5">
  <!-- Room Information and Cost Summary Section -->
  <div class="row">
    <!-- Room Information Section -->
    <div class="col-md-8">
      <div class="bg-light rounded shadow-sm p-4" style="background-color: #f8cdd6;">
        <h2 class="text-center mb-4" style="color: #4d4d4d;">Your Stay at Sakura Stay</h2>
        <div class="row">
          <div class="col-md-6">
            <% if @room.image.attached? %>
              <%= image_tag @room.image.variant(resize_to_fill: [400, 300]).processed, class: "img-fluid rounded", alt: @room.name %>
            <% else %>
              <div class="d-flex justify-content-center align-items-center bg-secondary text-white rounded" style="height: 300px;">
                <p>No image available</p>
              </div>
            <% end %>
          </div>
          <div class="col-md-6">
            <h4><%= @room.name %></h4>
            <p><strong>Capacity:</strong> <%= @room.capacity %> guests</p>
            <p><strong>Beds:</strong></p>
            <ul class="list-inline">
              <% @room.beds.each do |bed| %>
                <li class="list-inline-item badge bg-info text-dark"><%= bed.name %> (<%= bed.capacity %>)</li>
              <% end %>
            </ul>
            <p><strong>Services:</strong></p>
            <ul class="list-inline">
              <% @room.services.each do |service| %>
                <li class="list-inline-item badge bg-secondary"><%= service.name %></li>
                <p class="small"><%= service.description %></p>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Reservation Summary Section -->
    <div class="col-md-4">
      <div class="bg-light rounded shadow-sm p-4" style="background-color: #f8cdd6;">
        <h4 class="text-center" style="color: #4d4d4d;">Reservation Summary</h4>
        <p><strong>Check-in:</strong> <%= @check_in_date %></p>
        <p><strong>Check-out:</strong> <%= @check_out_date %></p>
        <p><strong>Price per night:</strong> $<%= @room.price %></p>
        <p><strong>Total nights:</strong> <%= (@check_out_date.to_date - @check_in_date.to_date).to_i %> nights</p>
        <p><strong>Total Cost:</strong> $<%= (@room.price * (@check_out_date.to_date - @check_in_date.to_date).to_i) %></p>
      </div>
    </div>
  </div>
  <!-- Comment Section -->
  <div class="bg-light mt-4 p-4 rounded shadow-sm" style="background-color: #f8cdd6;">
    <h4 class="mb-3" style="color: #4d4d4d;">Comments Section</h4>
    <!-- I'll set comments here -->
    <p class="text-muted">TEST, comment will go here later with there responses</p>
  </div>
  <!-- Payment Information Section -->
  <div class="row mt-4">
    <div class="col-md-6 offset-md-3">
      <div class="bg-light p-4 rounded shadow-sm" style="background-color: #f8cdd6;">
        <h4 class="text-center" style="color: #4d4d4d;">Payment Information</h4>
        <%= form_with model: @reservation, url: reservations_path, local: true do |form| %>
          <%= form.hidden_field :room_id, value: @room.id %>
          <%= form.hidden_field :check_in_date, value: @check_in_date %>
          <%= form.hidden_field :check_out_date, value: @check_out_date %>
          <!-- Name on Card -->
          <div class="form-group">
            <%= label_tag :card_name, "Name on Card" %>
            <%= text_field_tag :card_name, params[:card_name], class: "form-control", required: true %>
          </div>
          <!-- Card Number -->
          <div class="form-group">
            <%= label_tag :card_number, "Card Number" %>
            <%= text_field_tag :card_number, @card_number, class: "form-control", required: true, minlength: 16, maxlength: 16 %>
            <% if @payment_errors && @payment_errors[:card_number] %>
              <div class="text-danger"><%= @payment_errors[:card_number] %></div>
            <% end %>
          </div>
          <!-- Expiration Date and Security Code -->
          <div class="row">
            <div class="col-md-6 form-group">
              <%= label_tag :exp_date, "Expiration Date (MM/YY)" %>
              <%= text_field_tag :exp_date, @exp_date, class: "form-control", required: true, placeholder: "MM/YY" %>
              <% if @payment_errors && @payment_errors[:exp_date] %>
                <div class="text-danger"><%= @payment_errors[:exp_date] %></div>
              <% end %>
            </div>
            <div class="col-md-6 form-group">
              <%= label_tag :security_code, "Security Code" %>
              <%= text_field_tag :security_code, @security_code, class: "form-control", required: true, minlength: 3, maxlength: 3 %>
              <% if @payment_errors && @payment_errors[:security_code] %>
                <div class="text-danger"><%= @payment_errors[:security_code] %></div>
              <% end %>
            </div>
          </div>
          <!-- Submit Button -->
          <div class="text-center mt-4">
            <%= form.submit "Complete Reservation", class: "btn btn-primary btn-block w-100" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <!-- Back to Home or Cancel -->
  <div class="text-center mt-4">
    <%= link_to "Cancel Reservation", rooms_path, class: "btn btn-secondary me-2" %>
    <%= link_to "Back to Home", root_path, class: "btn btn-light" %>
  </div>
</div>